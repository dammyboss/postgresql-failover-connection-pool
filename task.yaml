id: postgresql-failover-connection-pool
prompt: |
  [Context]
  You are a DevOps engineer working on Bleater, a Kubernetes-based social media platform deployed in the `bleater` namespace.
  Information about the application is available at http://gitea.devops.local/root/bleater-app/wiki.
  Passwords are stored at http://passwords.devops.local.

  [Problem]
  After a recent PostgreSQL pod restart, Bleater services can no longer connect to the database.
  The connection pooler is running but all database connections are failing.

  [Task]
  Restore database connectivity. Investigate the connection pool layer and fix the root cause.

  Verify the fix by ensuring:
  - Database connectivity is fully restored for all Bleater services
  - All existing application data is intact and accessible
  - The fix is durable and self-healing — it must not require manual reconfiguration if the PostgreSQL pod is restarted or rescheduled again in the future
  - The connection pool is tuned so that connections do not persist longer than 1 hour (the current broken configuration holds them for 2 hours)
  - The connection pool actively cleans up idle connections — idle connections should time out in well under 10 minutes
  - The connection pool is configured to reset server-side connection state between client sessions

  IMPORTANT: Do NOT use any interactive commands, for example `-i` or `-it`, in `docker exec`,
  or any other TTY commands.

metadata:
  category: disaster-recovery
  difficulty: hard
